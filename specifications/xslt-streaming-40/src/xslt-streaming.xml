<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE spec SYSTEM "../../../schema/xsl-query.dtd" [

<!-- Things to update in these ENTITY definitions before publishing this document:
* Relationships between doc.stage, w3c-doctype, and doc.w3c-doctype-full
* doc.stage  w3c-doctype  doc.w3c-doctype-full
* FPWD       wd           First Public Working Draft
  WD         wd           Working Draft
  WD         wd           Last Call Working Draft
  CR         cr           Candidate Recommendation
  PR         pr           Proposed Recommendation
  PER        per          Proposed Edited Recommendation
  REC        rec          Recommendation
  WGNOTE     note         Working Group Note
* date.day, date.DD, date.month, date.monthnum, and date.year must represent the date of publication of the document
* doc.w3c-prevdesignation must properly represent the stage and shortname of the immediately preceding publication of the document
* Various status section generation ENTITY definitions below must be properly updated
-->

<!ENTITY doc.version "4.0">
<!ENTITY doc.major-version "4">
<!ENTITY doc.version-code "40">
<!ENTITY doc.stage "REC">
<!ENTITY doc.w3c-doctype "rec">
<!ENTITY doc.w3c-doctype-full "Editor's Draft">

<!-- N.B. The date 2000-01-01 is magic, it means "today". -->
<!ENTITY date.day "01">
<!ENTITY date.DD "01">
<!ENTITY date.month "January"> 
<!ENTITY date.monthnum "01">
<!ENTITY date.year "2000">
<!ENTITY doc.date "&date.year;&date.monthnum;&date.DD;">

<!ENTITY this-document "the &doc.w3c-doctype-full;">
<!ENTITY this-document "the second Public Working Draft">

<!ENTITY w3c.tr "https://www.w3.org/TR">
<!ENTITY doc.generic-shortname "xslt-xquery-serialization">
<!ENTITY doc.shortname "&doc.generic-shortname;-&doc.version-code;">
<!ENTITY doc.w3c-designation "&doc.stage;-&doc.shortname;">
<!ENTITY doc.publoc "&w3c.tr;/&date.year;/&doc.w3c-designation;-&doc.date;/">
<!ENTITY doc.latestloc "&w3c.tr;/&doc.shortname;/">
<!ENTITY doc.latestloc-major "&w3c.tr;/&doc.generic-shortname;-&doc.major-version;/">
<!ENTITY doc.latestloc-tech "&w3c.tr;/&doc.generic-shortname;/">
<!ENTITY doc.w3c-prev-designation "REC-&doc.shortname;">
<!ENTITY language-tech "XSLT and XQuery Serialization">
<!ENTITY language "XSLT and XQuery Serialization &doc.version;">
<!ENTITY language-major "XSLT and XQuery Serialization &doc.major-version;">
<!-- ************************ THIS MUST BE EITHER 'WG Review Draft' OR '' **************** -->
<!-- ENTITY version "WG Review Draft" -->
<!ENTITY version "">
<!-- ************************************************************************************* -->

<!ENTITY tm "&#x2122;">
<!ENTITY mdash "&#x2014;">
<!ENTITY rsquo "&#x2019;">
<!ENTITY ldquo "&#x201C;">
<!ENTITY rdquo "&#x201D;">

<!ENTITY errors SYSTEM "errors.xml">
<!ENTITY bibl SYSTEM "bibl.xml">

<!ENTITY % status-entities SYSTEM "../../../etc/status-entities.dtd">
%status-entities;

<!ENTITY doc.WD-pubdate "24 April 2014">
<!ENTITY doc.LC-pubdate "7 October 2014">
<!ENTITY doc.LC-comments-due "7 November 2014">
<!ENTITY doc.CR-pubdate "13 December 2016">
<!ENTITY doc.CR-comments-due "10 January 2017">
<!ENTITY doc.PR-expected "10 January 2017">
<!ENTITY doc.PR-pubdate "17 January 2017">
<!ENTITY doc.PR-comments-due "28 February 2017">
<!ENTITY doc.REC-pubdate "21 March 2017">

<!ENTITY doc.pubdate "&doc.REC-pubdate;">
<!ENTITY doc.comments-due "&doc.PR-comments-due;">

<!ENTITY status-section-id "status">
<!ENTITY spec-devby    "&devby.joint2;">
<!ENTITY changelog-id  "revision-log">
<!ENTITY changes-para  "&post.PR.nochanges;">
<!ENTITY implementation-report '&no-implementation-report-exists;'>
<!ENTITY implementation-report-location "&xquery-impl-report;">
<!ENTITY implementation-report-availability "&report-public;">
<!ENTITY disclosure.one    "&disclosure.xquery;"> 
<!ENTITY Bugzilla-key "SER40">
<!ENTITY patent-policy-paragraph "&ppp-two;">
<!ENTITY documents-and-relationships "&set-of-documents-30-preREC;">
<!ENTITY advancement.statement "&advance.2WGs;">
<!ENTITY document-stage "&doc-stage-REC;">
<!ENTITY doc-stability "&doc-stability-REC;">

<!ENTITY PR-entrance-criteria '<p>This document will be
considered ready for transition to Proposed Recommendation
at the same time that the XQuery 3.1 specification is ready
for transition to Proposed Recommendation. </p>'>
<!ENTITY features-at-risk-para "&no-features-at-risk;">

<!ENTITY customized-paragraph 
  '<p>This &doc.w3c-doctype-full; specifies XSLT and XQuery Serialization
   version 4.0, a fully compatible extension of
   <loc href="https://www.w3.org/TR/xslt-xquery-serialization-31/">Serialization version 3.1</loc>.</p>'>

<!ENTITY status-section SYSTEM "../../../etc/status-general.xml">

]>
<spec id="spec-top" w3c-doctype="&doc.w3c-doctype;" status="int-review">

  <header id="spec-header">
  <title>&language;</title>
  <version>&version;</version>
    <w3c-designation>&doc.w3c-designation;</w3c-designation>
    <w3c-doctype>W3C &doc.w3c-doctype-full;</w3c-doctype>
  <pubdate>
    <day>&date.day;</day>
    <month>&date.month;</month>
    <year>&date.year;</year>
  </pubdate>
  <publoc>
    <loc href="&doc.publoc;">&doc.publoc;</loc>
  </publoc>
<!-- These altlocs URIs are computed from the concatenation of doc.public, doc.shortname, and either '.xml' or
     '-diff-from-yyyymmdd.html', where 'yyyymmdd' is the earlier version of the spec from which a diff has been produced -->
  <altlocs>
    <loc href="&doc.publoc;&doc.shortname;.xml">XML</loc>
  </altlocs>
<!-- The latestloc URI is computed from doc.latestloc -->
  <latestloc doc="&language;">
    <loc href="&doc.latestloc;">&doc.latestloc;</loc>
  </latestloc>
<!-- These prevlocs URIs are always hard-coded and are never computed from entities -->
  <!--<prevlocs doc="&language;">
  <loc xmlns:xlink="http://www.w3.org/1999/xlink" href="https://www.w3.org/TR/2017/PR-xslt-xquery-serialization-31-20170117/" xlink:type="simple" xlink:show="replace" xlink:actuate="onRequest">https://www.w3.org/TR/2017/PR-xslt-xquery-serialization-31-20170117/</loc>
  <loc xmlns:xlink="http://www.w3.org/1999/xlink" href="https://www.w3.org/TR/2016/CR-xslt-xquery-serialization-31-20161213/" xlink:type="simple" xlink:show="replace" xlink:actuate="onRequest">https://www.w3.org/TR/2016/CR-xslt-xquery-serialization-31-20161213/</loc>
  <loc xmlns:xlink="http://www.w3.org/1999/xlink" href="https://www.w3.org/TR/2015/CR-xslt-xquery-serialization-31-20151217/" xlink:type="simple" xlink:show="replace" xlink:actuate="onRequest">https://www.w3.org/TR/2015/CR-xslt-xquery-serialization-31-20151217/</loc>
  </prevlocs>-->
  <latestloc-major doc="&language-major;">
    <loc href="&doc.latestloc-major;">&doc.latestloc-major;</loc>
  </latestloc-major>
  <latestloc-tech doc="&language-tech;">
    <loc href="&doc.latestloc-tech;">&doc.latestloc-tech;</loc>
  </latestloc-tech>
  <prevrec doc="&language-tech;">
    <loc href="https://www.w3.org/TR/xslt-xquery-serialization-31/">https://www.w3.org/TR/xslt-xquery-serialization-31/</loc>
  </prevrec>

  <authlist>
    <author>
      <name>Michael Kay</name>
      <affiliation>Saxonica</affiliation>
      <email href="https://www.saxonica.com/">https://www.saxonica.com/</email>
    </author>
   
  </authlist>
  <errataloc href="https://www.w3.org/XML/2017/qt-errata/xslt-xquery-serialization-40-errata.html" 
    xlink:type="simple" xmlns:xlink="http://www.w3.org/1999/xlink"
  />

  <translationloc 
    href="https://www.w3.org/2003/03/Translations/byTechnology?technology=xslt-xquery-serialization-40"/>

&status-section;

<abstract>
  <p>This document defines the streaming feature of XSLT 4.0.</p>
</abstract>

<langusage>
<language id="en">English</language>
</langusage>

<revisiondesc>
<p>See the CVS changelog.</p>
</revisiondesc>
</header>

<body>

<div1 id="intro">
<head>Introduction</head>
  
  <changes>
    <change>Use the arrows to browse significant changes since the 3.1 version of this specification.</change>
    <change>Sections with significant changes are marked Î” in the table of contents.</change>
  </changes>

<p>This document defines the streaming feature of the XSLT 4.0 language: see
<bibref ref="xslt-40"/>.</p>

<p>In this document, examples and material labeled as <quote>Note</quote> are provided for
explanatory purposes and are not normative. </p>



<div2 id="terminology">
  <head>Terminology</head>
  
  <changes>
     <change issue="1337" date="2024-08-02">
        The term <term>atomic value</term> has been replaced by <term>atomic item</term>.
     </change>
  </changes>
  
<p>In this specification,
where they are rendered in small capitals,
the words <rfc2119>MUST</rfc2119>, <rfc2119>MUST NOT</rfc2119>,
<rfc2119>SHOULD</rfc2119>, <rfc2119>SHOULD NOT</rfc2119>, <rfc2119>MAY</rfc2119>, 
  <rfc2119>REQUIRED</rfc2119>, and
<rfc2119>RECOMMENDED</rfc2119> are to be interpreted as described in
<bibref ref="RFC2119"/>.</p>
<p><termdef id="serializer" term="serializer">As is indicated in
<specref ref="conformance"/>, conformance criteria for serialization
are determined by other specifications that refer to this specification.
A <term>serializer</term> is software that implements some or all of the
requirements of this specification in accordance with such conformance
criteria.</termdef>  A serializer is not <rfc2119>REQUIRED</rfc2119> to directly provide a
programming interface that permits a user to set serialization parameters
or to provide an input sequence for serialization.<!--Text inserted by erratum E11 change 1"-->
In this document, material labeled
as "Note" and examples are provided for explanatory purposes and are not
normative.
<!--End of text inserted by erratum E11-->
</p>
<p>Certain aspects of serialization are described in this specification 
as <termref def="impdef">implementation-defined</termref> 
or <termref def="impdep">implementation-dependent</termref>.</p>
<p>
<termdef id="impdef" term="implementation-defined"><term>Implementation-defined</term> indicates an
aspect that <rfc2119>MAY</rfc2119> differ between
<termref def="serializer">serializers</termref>, but whose actual
behavior <rfc2119>MUST</rfc2119> be specified either by another specification that sets
conformance criteria for serialization (see <specref ref="conformance"/>)
or in documentation that accompanies the
<termref def="serializer">serializer</termref>.</termdef></p>
<p>
<termdef id="impdep" term="implementation-dependent"><term>Implementation-dependent</term> indicates an
aspect that <rfc2119>MAY</rfc2119> differ between
<termref def="serializer">serializers</termref>, and whose actual
behavior is not <rfc2119>REQUIRED</rfc2119>  to be specified either by another specification
that sets conformance criteria for serialization (see
<specref ref="conformance"/>) or in documentation that accompanies the
<termref def="serializer">serializer</termref>.</termdef></p>
<p>
<termdef id="serial-err" term="serialization error">In some instances, the
<termref diff="chg" at="2023-11-01" def="dt-input-tree"/> cannot be successfully converted
into a sequence of octets given the set of serialization parameter
(<specref ref="serparam"/>) values specified.  A
<term>serialization error</term> is said to occur in such an instance.</termdef>
In some cases, a <termref def="serializer">serializer</termref> is
<rfc2119>REQUIRED</rfc2119>  to <term>raise</term> such an error.
What it means to raise a serialization error is determined by the
relevant conformance criteria (<specref ref="conformance"/>) to which
the <termref def="serializer">serializer</termref> conforms.  In other cases,
there is an <termref def="impdef">implementation-defined</termref> choice
between raising a serialization error and performing a recovery action.
Such a recovery action will allow a
<termref def="serializer">serializer</termref> to produce a sequence of
octets that might not fully reflect the usual requirements of the
parameter settings that are in effect.
</p>
<!-- Start of text added for Bug 8651 (Erratum SE.E17) -->
<p>
<termdef id="caseless-compare" term="without regard to case">
Where this specification indicates that two strings are to be
compared <term>without regard to case</term>, the <termref def="serializer">serializer</termref>
<rfc2119>MUST</rfc2119> translate any characters in the range
<char>U+0041</char> through <char>U+005A</char>
inclusive, to the corresponding lower-case letters in the range
<char>U+0061</char> through <char>U+007A</char> only
for the purposes of making the comparison.  The comparison
succeeds if the two strings are the same length and the code
point of each character in the first string is equal to the
code point of the character in the corresponding position in
the second string.</termdef>
</p>
<!-- End of text added for Bug 8651 (Erratum SE.E17) -->
<p>Many terms used in this document are defined in the XPath specification 
<bibref ref="xpath-40"/> or the Data Model specification <bibref ref="xpath-datamodel-40"/>. Particular
attention is drawn to the following:</p>

<ulist>

<item>
<p><termdef id="dt-atomization" term="atomize">The term <term>atomization</term> is defined
in <xspecref spec="XP40" ref="id-atomization"/>.</termdef></p>
</item>

<item>
<p><termdef id="dt-node" term="node">The term <term>node</term>
is defined as part of   <xspecref spec="DM40" ref="Node"/>. 
There are seven kinds of <termref def="dt-node">nodes</termref> in the data model: document, element, attribute, text, namespace, processing instruction, and comment.</termdef></p>
</item>

<item>
<p><termdef id="dt-sequence" term="sequence">The term <term>sequence</term>
is defined in <xspecref spec="XP40" ref="id-basics"/>. 
A <termref def="dt-sequence">sequence</termref> is an ordered collection of zero or more items.</termdef></p>
</item>

<item>
<p><termdef id="dt-function-item" term="function item">The term
<term>function item</term> is defined in
<xspecref spec="DM40" ref="function-items"/>.</termdef></p>
</item>

<item>
<p><termdef id="dt-map-item" term="map item">The term
<term>map item</term> is defined in
<xspecref spec="DM40" ref="map-items"/>.</termdef></p>
</item>

<item>
<p><termdef id="dt-array-item" term="array item">The term
<term>array item</term> is defined in
<xspecref spec="DM40" ref="array-items"/>.</termdef></p>
</item>

<item>
<p><termdef id="dt-string" term="string">The term
<term>string</term> is defined in
<xspecref spec="DM40" ref="xml-and-xsd-versions"/>.</termdef></p>
</item>

<item>
<p><termdef id="dt-character" term="character">The term
<term>character</term> is defined in
<xspecref spec="DM40" ref="xml-and-xsd-versions"/>.</termdef></p>
</item>

<item>
<p><termdef id="dt-codepoint" term="codepoint">The term
<term>codepoint</term> is defined in
<xspecref spec="DM40" ref="xml-and-xsd-versions"/>.</termdef></p>
</item>

<item>
<p><termdef id="dt-string-value" term="string value">The term <term>string value</term>
is defined in <xspecref spec="DM40" ref="dm-string-value"/>. 
Every <termref def="dt-node">node</termref> has a <termref def="dt-string-value">string value</termref>. For example, the <termref def="dt-string-value">string value</termref>
of an element is the concatenation of the <termref def="dt-string-value">string values</termref> of all its descendant text <termref def="dt-node">nodes</termref>.</termdef></p>
</item>

<item>
<p><termdef id="dt-expanded-qname" term="expanded QName">The term <term>expanded QName</term>
is defined in <xspecref spec="XP40" ref="id-basics"/>. 
An <termref def="dt-expanded-qname">expanded QName</termref> consists of an optional namespace URI and a local name. An <termref def="dt-expanded-qname">expanded QName</termref> also retains its original namespace prefix (if any), to facilitate casting the expanded QName into a string.</termdef></p>
</item>

<item>
<p><termdef id="null-namespace-URI" term="null namespace URI">
An <termref def="dt-expanded-qname">expanded-QName</termref> whose 
namespace part is an empty sequence,
or an element or attribute whose name expands to such 
an <termref def="dt-expanded-qname">expanded-QName</termref>,
is referred to as having a <term>null namespace URI</term></termdef>.</p>
</item>

<item>
<p><termdef id="non-null-namespace-URI" term="non-null namespace URI">An element or attribute that does not have a <termref def="null-namespace-URI">null namespace URI</termref>, is referred to as having a <term>non-null namespace URI</term></termdef>.</p>
</item>

<item>
<p>
<termdef id="whitespace-char" term="whitespace character">A space character,
TAB character, CR character or NL character is referred to as a
<term>whitespace character</term>.</termdef></p>
</item>
</ulist>

<p>Where this specification indicates that an
XSLT instruction is evaluated, the behavior is as specified by
<bibref ref="xslt-40"/>.  Where it indicates that an XQuery expression is
evaluated, the behavior is as specified by <bibref ref="xquery-40"/>.</p>
</div2>

<div2 id="namespaces">
<head>Namespaces</head>
<p>This specification refers to several namespaces that affect the process
of serialization.  These are:</p>
<ulist>
<item><p><termdef id="output-namespace" term="Output declaration namespace">the
<term>Output declaration namespace</term>,
<code>https://www.w3.org/2010/xslt-xquery-serialization</code></termdef>;</p></item>
<item><p><termdef id="xml-namespace" term="XML namespace">the
<term>XML namespace</term>,
<code>https://www.w3.org/XML/1998/namespace</code></termdef>;</p></item>
<item><p><termdef id="xhtml-namespace" term="XHTML namespace">the
<term>XHTML namespace</term> namespace,
<code>https://www.w3.org/1999/xhtml</code></termdef>;</p></item>
<item><p><termdef id="svg-namespace" term="SVG namespace">the
<term>SVG namespace</term>,
<code>https://www.w3.org/2000/svg</code></termdef>; and</p></item>
<item><p><termdef id="mathml-namespace" term="MathML namespace">the
<term>MathML namespace</term> namespace,
<code>https://www.w3.org/1998/Math/MathML</code>.</termdef></p></item>
</ulist>
<p>Wherever an element node or attribute node is said to be in a
particular namespace, it is understood that the namespace URI of the
node is equal to the namespace URI corresponding to that namespace.
Wherever a namespace node is said to be a namespace node for a
particular namespace, it is understood that the
<termref def="dt-string-value">string value</termref> of the node is
equal to the namespace URI corresponding to that namespace.</p>
</div2>
</div1>











<div1 id="conformance"><head>Conformance</head>
<p>Serialization is intended primarily as a component
of a <termref def="host-language">host language</termref>.
<termdef term="host language" id="host-language">
A <term>host language</term> is another
specification that includes, by reference, this specification and all of
its requirements.  A host language might be a programming language
such as <bibref ref="xslt-40"/> or <bibref ref="xquery-40"/>, or it
might be an application programming interface (API) intended to be used by
programs written in some other high-level programming language.  The use of
the term <emph>language</emph> is not intended to preclude the possibility that
this specification might be referenced outside the context of a
programming language specification.</termdef>
This document
relies on specifications that use it to specify conformance criteria
for Serialization in their respective environments.
Specifications that set conformance criteria for their use of
Serialization <rfc2119>MUST NOT</rfc2119> change the semantic definitions of 
Serialization as given in this specification, except by
subsetting and/or compatible extensions.  It is the responsibility of the <termref def="host-language">host language</termref> to specify how <termref def="serial-err">serialization errors</termref>
are to
be handled.</p>
<p>Certain facilities in this specification are described as producing 
<termref def="impdef">implementation-defined</termref> results. A
claim that asserts conformance with this specification <rfc2119>MUST</rfc2119> be accompanied by documentation
stating the effect of each implementation-defined feature. For convenience, a non-normative
checklist of implementation-defined features is provided at 
<specref ref="implementation-defined-features"/>.</p></div1>
</body>

<back>





<inform-div1 id="revision-log">
<head>Change Log</head>
  <p>This appendix lists changes made in version 4.0 of this specification.</p>
  
  <?change-log?>

</inform-div1>

</back>	
</spec>
